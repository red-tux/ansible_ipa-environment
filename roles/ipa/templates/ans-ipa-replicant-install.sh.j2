#!/bin/bash

ipa-replica-install \
-U \
-w $JOIN_PASSWORD \
-p {{ join_account }} \
--hostname={{ hostname | default(ansible_fqdn)}} \
--ip-address={{ replicate_with }} \
{{ '--forwarder=%s' % ipaserver_dns_forwarder 
   if ipaserver_dns_forwarder | default(False) else '--no-forwarders' }} \
{{ '--mkhomedir' if ipaserver_mkhomedir | default(True) else '' }} \
{{ '--setup-dns' if ipaserver_setup_dns | default(True) else '' }} \
{{ '--setup-ca' if ipaserver_setup_ca | default(True) else '' }} \
{{ '--ssh-trust-dns' if ipaserver_ssh_trust_dns | default(True) else '' }} \
{{ '' if ipaserver_hbac_allow | default(True) else '--no_hbac_allow' }} \
{{ '' if ipaserver_setup_ntp | default(True) else '--no-ntp' }} \
{{ '' if ipaserver_configure_ssh | default(True) else '--no-ssh' }} \
{{ '' if ipaserver_configure_sshd | default(True) else '--no-sshd' }} \
{{ '' if ipaserver_ui_redirect | default(True) else '--no-ui-redirect' }} \
{{ '' if ipaserver_host_dns | default(True) else '--no-host-dns' }} \
{{ '--auto-reverse' if ipaserver_auto_reverse | default(True) else '' }} \
{{ '--allow-zone-overlap' if ipaserver_zone_overlap | default(False) else '' }} \

